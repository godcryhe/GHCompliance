define(["util","JC.Valid"],function(t,i){var o,n,e={};e.init=function(){if(o=$("#regForm"),n=$("#logForm"),e.regFormCtl(),e.bindForgetVerify(),e.bindCheckUsername(),e.bindCheckPhone(),e.bindNewPwd(),e.bindSendEmail(),e.snsLogCtl(),$(document).on("submit","#logForm",function(){var t=$(this);if(i(t)){var o=t.find(":submit");o.text("登录中...")}}),n.length){var t=n.find('input[name="username"]'),r=n.find('input[name="password"]');t.val()?r.val()||r.focus():t.focus()}},e.bindSendEmail=function(){var t=$("#sendEmailForm");t.length&&t.on("submit",function(){var o=t.attr("action"),n=t.serialize(),e=t.attr("method");return i(t)&&Zlib.tool.ajax(o,e,n).done(function(t){t.code<=0?Zlib.tool.showFail(t.msg,$(".next-btn")):(Zlib.tool.showSucc("邮件发送成功！"),setTimeout(function(){window.location.href=t.url},1e3))}).fail(function(){Zlib.tool.showFail("网络不给力，请重新尝试")}),!1})},e.bindNewPwd=function(){var t=$("#newPwdForm");t.length&&t.on("submit",function(){var t=$(this).attr("action"),o=$(this).serialize(),n=$(this).attr("method");return i($(this))&&Zlib.tool.ajax(t,n,o).done(function(t){t.code<=0?Zlib.tool.showFail(t.msg,$(".next-btn")):(Zlib.tool.showSucc("密码修改成功！正在为您跳转..."),setTimeout(function(){window.location.href=t.url},1e3))}).fail(function(){Zlib.tool.showFail("网络不给力，请重新尝试")}),!1})},e.bindCheckPhone=function(){var t=$("#checkPhoneForm");t.length&&t.on("submit",function(){var t=$(this).attr("action"),o=$(this).serialize(),n=$(this).attr("method");return i($(this))&&Zlib.tool.ajax(t,n,o).done(function(t){t.code<=0?Zlib.tool.showFail(t.msg,$(".next-btn")):(Zlib.tool.showSucc("验证成功！正在为您跳转..."),setTimeout(function(){window.location.href=t.url},1e3))}).fail(function(){Zlib.tool.showFail("网络不给力，请重新尝试")}),!1})},e.bindCheckUsername=function(){var t=$("#forgetForm");t.length&&t.on("submit",function(){var t=$(this).attr("action"),o=$(this).serialize(),n=$(this).attr("method");return i($(this))&&Zlib.tool.ajax(t,n,o).done(function(t){t.code<=0?(Zlib.tool.showFail(t.msg,$(".next-btn")),e.refreshVerify()):window.location.href=t.url}).fail(function(){Zlib.tool.showFail("网络不给力，请重新尝试")}),!1})},e.bindForgetVerify=function(){if($(".verifyimg").length){var t=$(".verifyimg").attr("src");$(".reloadverify").click(function(){t.indexOf("?")>0?$(".verifyimg").attr("src",t+"&random="+Math.random()):$(".verifyimg").attr("src",t.replace(/\?.*$/,"")+"?"+Math.random())})}},e.refreshVerify=function(){if($(".verifyimg").length){var t=$(".verifyimg").attr("src");t.indexOf("?")>0?$(".verifyimg").attr("src",t+"&random="+Math.random()):$(".verifyimg").attr("src",t.replace(/\?.*$/,"")+"?"+Math.random())}},e.regFormCtl=function(){o.length&&o.on("submit",function(){var t=$(this).attr("action"),o=$(this).serialize(),n=$(this).attr("method");return i($(this))&&Zlib.tool.ajax(t,n,o).done(function(t){t.code<=0?Zlib.tool.showFail(t.msg,$(".btn-submit")):window.location.href=t.url}).fail(function(){Zlib.tool.showFail("网络不给力，请重新尝试")}),!1})};var r=function(){function t(){for(var t in i)t.indexOf("/user")>-1&&(i[t].close&&i[t].close(),i[t]=null,delete i[t])}var i={};return{open:function(o){var n,e;return i[o]&&i[o].closed===!1?void(i[o].focus&&i[o].focus()):(t(),n=(screen.width-600)/2,e=(screen.height-400)/2,void(i[o]=window.open(o,"_blank","toolbar=no, directories=no, status=no, menubar=no, width=600, height=500, top="+e+", left="+n)).focus())},clear:t}}();return e.snsLogCtl=function(){$(document).on("click","a[data-sns]",function(t){t.preventDefault();var i=$(this).data("sns");try{r.open(i)}catch(t){window.location=i}})},e});